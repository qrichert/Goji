var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
var DropzoneItem=function(a,c,b,d,f,e){this.m_parent=null;this.m_dropzone=a;this.m_file=c;this.m_action=b;this.m_callbackSuccess=d;this.m_inputName=f;this.m_defaultFileIcon=e;this.m_xhr=this.m_progress=null;this.m_uploadInProgress=!1;this.m_fileTypesImages=["image/gif","image/jpeg","image/jpg","image/png","image/svg+xml"];this.m_fileTypesVideos=["video/mp4"];this.buildElement();this.m_dropzone.appendChild(this.m_parent);this.startUpload()};
DropzoneItem.prototype.extractFileName=function(a){a=a.name.match(/^(.+)\.([^.]+)$/);return null!==a?a[1]:""};DropzoneItem.prototype.readFile=function(a,c){var b=new FileReader;b.addEventListener("error",function(b){b.preventDefault();b=document.createElement("p");b.classList.add("dropzone__item-icon");b.textContent=a.name;"undefined"===typeof c.parentElement||null===c.parentElement?c=b:c.parentElement.replaceChild(b,c)},!1);b.addEventListener("load",function(){c.src=b.result},!1);b.readAsDataURL(a)};
DropzoneItem.prototype.buildElement=function(){var a=this,c=this.m_file.get("file"),b=null;if(this.m_fileTypesImages.includes(c.type)&&3E7>c.size)b=document.createElement("img"),b.alt="",this.readFile(c,b);else if(this.m_fileTypesVideos.includes(c.type)&&3E7>c.size)b=document.createElement("video"),b.autoplay=!0,b.loop=!0,b.muted=!0,b.volume=0,b.setAttribute("type",c.type),b.setAttribute("webkit-playsinline",""),b.setAttribute("playsinline",""),b.playsinline=!0,b.addEventListener("canplaythrough",
function(){"video"===b.tagName&&b.play()},!1),this.readFile(c,b);else if(null!==this.m_defaultFileIcon){b=document.createElement("div");var d=document.createElement("img");d.src=this.m_defaultFileIcon;d.alt="";b.appendChild(d);d=document.createElement("p");d.textContent=this.extractFileName(c);b.appendChild(d)}else b=document.createElement("p"),b.textContent=this.extractFileName(c);c=document.createElement("div");c.classList.add("dropzone__item");c.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation()},!1);b.classList.add("dropzone__item-icon");c.appendChild(b);d=document.createElement("div");d.classList.add("dropzone__item-progress");c.appendChild(d);this.m_progress=document.createElement("div");d.appendChild(this.m_progress);d=document.createElement("div");d.classList.add("dropzone__item-cancel");c.appendChild(d);d.addEventListener("click",function(){a.cancelUpload()},!1);this.m_parent=c};
DropzoneItem.prototype.uploadLoad=function(a){if(this.m_uploadInProgress&&null!==this.m_xhr)if(4!==this.m_xhr.readyState||200!==parseInt(this.m_xhr.status,10))this.uploadError(a);else{a=null;try{a=JSON.parse(this.m_xhr.responseText)}catch(c){this.uploadError(c);return}null!==this.m_callbackSuccess&&this.m_callbackSuccess(a);this.endUpload()}};DropzoneItem.prototype.uploadError=function(a){this.endUpload();this.m_parent.classList.add("error")};
DropzoneItem.prototype.uploadAbort=function(a){this.endUpload();this.m_dropzone.removeChild(this.m_parent)};DropzoneItem.prototype.uploadProgress=function(a){a.lengthComputable&&(a=a.loaded/a.total,isNaN(a)&&(a=0),this.m_progress.style.width=100*a+"%",1<=a&&this.m_parent.classList.remove("cancelable"))};
DropzoneItem.prototype.startUpload=function(){var a=this;this.m_parent.classList.add("uploading");this.m_parent.classList.add("cancelable");this.m_progress.style.width="0%";var c=new FormData;c.append(this.m_inputName,this.m_file.get("file"));this.m_xhr=new XMLHttpRequest;this.m_xhr.addEventListener("load",function(b){a.uploadLoad(b)},!1);this.m_xhr.addEventListener("error",function(b){a.uploadError(b)},!1);this.m_xhr.addEventListener("abort",function(b){a.uploadAbort(b)},!1);this.m_xhr.upload.addEventListener("progress",
function(b){a.uploadProgress(b)},!1);this.m_xhr.open("POST",this.m_action);this.m_xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");this.m_xhr.send(c);this.m_uploadInProgress=!0};DropzoneItem.prototype.endUpload=function(){this.m_parent.classList.remove("uploading");this.m_parent.classList.remove("cancelable");this.m_progress.style.width="0%";this.m_uploadInProgress=!1;this.m_xhr=null};DropzoneItem.prototype.cancelUpload=function(){this.m_uploadInProgress&&this.m_xhr.abort()};
var Dropzone=function(a,c,b,d,f,e){b=void 0===b?null:b;d=void 0===d?null:d;f=void 0===f?null:f;e=void 0===e?null:e;this.m_dropzone=a;this.m_dropzone.classList.add("waiting-for-files");this.m_fileInput=c;this.m_fileInput.style.display="none";this.m_fileInput.multiple=!0;this.m_callbackSuccess=b;this.m_callbackErrorFileTooHeavy=f;this.m_callbackErrorFileTypeInvalid=d;this.m_form=null;for(a=this.m_fileInput;null===this.m_form&&(a=a.parentElement,"undefined"!==typeof a&&null!==a);)if("form"===a.tagName.toLowerCase())this.m_form=
a;else if("html"===a.tagName.toLowerCase())break;if(null===this.m_form)throw"<form> parent of file input not found.";this.m_form.enctype="multipart/form-data";this.m_action=this.m_form.action;if(""===this.m_action||null===this.m_action)this.m_action=location.href;this.m_files=[];null===e&&(e={});this.m_fileTypesAllowed=this.m_fileInput.accept||"";this.m_fileTypesAllowed=""===this.m_fileTypesAllowed?[]:this.m_fileTypesAllowed.split(",");this.m_maxFileSize=this.m_fileInput.dataset.maxFileSize||-1;this.m_maxFileSize=
parseInt(this.m_maxFileSize,10);this.m_defaultFileIcon=this.coalesce(e,"default_file_icon",null);this.m_successfulDropHappened=!1;this.addEventListeners()};Dropzone.prototype.coalesce=function(a,c,b){return"undefined"!=typeof a&&null!==a&&a.hasOwnProperty(c)?a[c]:b};
Dropzone.prototype.addEventListeners=function(){var a=this;this.m_dropzone.addEventListener("dragenter",function(c){c.preventDefault();a.startDrag()},!1);this.m_dropzone.addEventListener("dragleave",function(c){c.preventDefault();a.stopDrag()},!1);this.m_dropzone.addEventListener("dragover",function(a){a.preventDefault()},!1);this.m_dropzone.addEventListener("drop",function(c){c.preventDefault();a.stopDrag();a.drop(c)},!1);this.m_fileInput.addEventListener("change",function(c){c.preventDefault();
a.filesChanged()},!1)};Dropzone.prototype.startDrag=function(){this.m_dropzone.classList.add("hover")};Dropzone.prototype.stopDrag=function(){this.m_dropzone.classList.remove("hover")};Dropzone.prototype.extractFileType=function(a){var c=a.name.match(/\.([^.]+)$/);null!==c?c=c[1]:(c=a.type.match(/\/([^.]+)$/),c=null!==c?c[1]:"?");return"."+c};
Dropzone.prototype.fileIsValid=function(a){if(""===a.type)return null!==this.m_callbackErrorFileTypeInvalid&&this.m_callbackErrorFileTypeInvalid("_folder_"),!1;if(0<this.m_fileTypesAllowed.length){var c=this.extractFileType(a);if(!this.m_fileTypesAllowed.includes(c))return null!==this.m_callbackErrorFileTypeInvalid&&this.m_callbackErrorFileTypeInvalid(c),!1}return 0<this.m_maxFileSize&&a.size>this.m_maxFileSize?(null!==this.m_callbackErrorFileTooHeavy&&this.m_callbackErrorFileTooHeavy(a.size),!1):
!0};Dropzone.prototype.drop=function(a){var c=[];if(a.dataTransfer.items){a=$jscomp.makeIterator(a.dataTransfer.items);for(var b=a.next();!b.done;b=a.next())if(b=b.value,"file"===b.kind&&(b=b.getAsFile(),this.fileIsValid(b))){var d=new Map;d.set("file",b);c.push(d)}}else for(a=$jscomp.makeIterator(a.dataTransfer.files),b=a.next();!b.done;b=a.next())b=b.value,this.fileIsValid(b)&&(d=new Map,d.set("file",b),c.push(d));this.newFiles(c)};
Dropzone.prototype.filesChanged=function(){for(var a=[],c=0;c<this.m_fileInput.files.length;c++){var b=this.m_fileInput.files[c];if(this.fileIsValid(b)){var d=new Map;d.set("file",b);a.push(d)}}this.newFiles(a)};
Dropzone.prototype.newFiles=function(a){if(!(0>=a.length)){if(!this.m_successfulDropHappened){for(this.m_successfulDropHappened=!0;this.m_dropzone.firstChild;)this.m_dropzone.removeChild(this.m_dropzone.firstChild);this.m_dropzone.classList.remove("waiting-for-files")}for(var c=$jscomp.makeIterator(a),b=c.next();!b.done;b=c.next()){b=b.value;var d=new DropzoneItem(this.m_dropzone,b,this.m_action,this.m_callbackSuccess,this.m_fileInput.name,this.m_defaultFileIcon);b.set("dropzone_item",d)}this.m_files=
this.m_files.concat(a)}};
