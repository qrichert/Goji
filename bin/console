#!/usr/bin/env bash

COMMAND=''

if [[ -z "$1" ]] || [[ $1 = '-h' ]] || [[ $1 = '--help' ]]; then
	echo "Commands:"
	echo "  build        Build Docker container"
	echo "  buildnrun    Build Docker container and run it"
	echo "  stop         Stop running Docker container"
	echo "  push         Push new commits to Git repository"
	echo "  update       Update from Git repository and rebuild Docker container"
	echo "  undocommit   Undo last commit (soft)"
	echo "  clearcache   Delete content of cache folder (/var/cache/*.cache)"
	echo "  freeze       Freeze pip packages into requirements.txt file"

	exit 0
else
	COMMAND=$1

	if [[ $COMMAND = 'build' ]]; then
		docker-compose build
	elif [[ $COMMAND = 'buildnrun' ]]; then
		docker-compose up --build --detach
	elif [[ $COMMAND = 'stop' ]]; then
		docker-compose down
	elif [[ $COMMAND = 'push' ]]; then
		#git checkout main && git merge dev && git checkout dev
		git pull && git push && git checkout main && git pull && git merge dev && git push && git checkout dev
	elif [[ $COMMAND = 'update' ]]; then
		git pull && docker-compose up --build --detach
	elif [[ $COMMAND = 'undocommit' ]]; then
		git reset --soft HEAD~1
	elif [[ $COMMAND = 'clearcache' ]]; then
		rm -f var/cache/*.cache
	elif [[ $COMMAND = 'freeze' ]]; then
		pip freeze > requirements.txt
	else
		echo "Error: Command not found."
	fi
fi
